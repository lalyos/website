<!DOCTYPE html>
<html id="docs" lang="en" class="">
	<head>
	<meta charset="utf-8">
<title>Set up placement policies in Federation - Kubernetes</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" type="image/png" href="/images/favicon.png">
<link rel="stylesheet" type="text/css" href="/css/base_fonts.css">
<link rel="stylesheet" type="text/css" href="/css/styles.css">
<link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">
<link rel="stylesheet" type="text/css" href="/css/callouts.css">
<link rel="stylesheet" type="text/css" href="/css/custom-jekyll/tags.css">




<meta name="description" content="Set up placement policies in Federation" />
<meta property="og:description" content="Set up placement policies in Federation" />

<meta property="og:url" content="https://kubernetes.io/docs/tasks/federation/set-up-placement-policies-federation/" />
<meta property="og:title" content="Set up placement policies in Federation - Kubernetes" />

<script
src="https://code.jquery.com/jquery-3.2.1.min.js"
integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
crossorigin="anonymous"></script>
<script
src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
<script src="/js/script.js"></script>
<script src="/js/custom-jekyll/tags.js"></script>


	</head>
	<body>
		<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            
            
            <li><a href="/docs/home/">Documentation</a></li>
            
            <li><a href="/blog/">Blog</a></li>
            
            <li><a href="/partners/">Partners</a></li>
            
            <li><a href="/community/">Community</a></li>
            
            <li><a href="/case-studies/">Case Studies</a></li>
            
            
             <li>
                <a href="#">
                    English <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    <li><a href="/cn/">Chinese</a></li>
                
                </ul>
            </li>
         
            <li>
                <a href="#">
                    v1.11 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    <li><a href="https://kubernetes.io">v1.11</a></li>
                
                    <li><a href="https://kubernetes.io">v1.10</a></li>
                
                    <li><a href="https://v1-9.docs.kubernetes.io">v1.9</a></li>
                
                    <li><a href="https://v1-8.docs.kubernetes.io">v1.8</a></li>
                
                    <li><a href="https://v1-7.docs.kubernetes.io">v1.7</a></li>
                
                </ul>
            </li>
        </ul>
        
        <a href="/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>Try Kubernetes</a>
        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
        <div class="nav-box">
            <h3><a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a></h3>
            <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>
        </div>
        <div class="nav-box">
            <h3><a href="/docs/home/">Documentation</a></h3>
            <p>Learn how to use Kubernetes with the use of walkthroughs, samples, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>
        </div>
        <div class="nav-box">
            <h3><a href="/community/">Community</a></h3>
            <p>If you need help, you can connect with other Kubernetes users and the Kubernetes authors, attend community events, and watch video presentations from around the web.</p>
        </div>
        <div class="nav-box">
            <h3><a href="/blog/">Blog</a></h3>
            <p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>
        </div>
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
            <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
        </div>

        <div class="right">
            <h5 class="github-invite">Explore the community</h5>
            <div class="social">
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://discuss.kubernetes.io" class="mailing-list"><span>Forum</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>

		
		
		<section id="hero" class="light-text no-sub">
			











<h1>Tasks</h1>
<h5></h5>






<div id="vendorStrip" class="light-text">
	<ul>
		
		
		<li><a href="/docs/home/">DOCUMENTATION</a></li>
		
		
		<li><a href="/docs/setup/">SETUP</a></li>
		
		
		<li><a href="/docs/concepts/">CONCEPTS</a></li>
		
		
		<li><a href="/docs/tasks/" class="YAH">TASKS</a></li>
		
		
		<li><a href="/docs/tutorials/">TUTORIALS</a></li>
		
		
		<li><a href="/docs/reference/">REFERENCE</a></li>
		
	</ul>
	<div id="searchBox">
		<input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)" autofocus="autofocus">
	</div>
</div>

		</section>
		
		

		<section id="encyclopedia">
			
<div id="docsToc">
     <div class="pi-accordion">
    	
        
        
        
        
        
         
             
                 
             
         
             
                 
             
         
             
                 
             
         
             
                 
             
         
             
                 
                          
                          
                 
             
         
             
         
             
         
             
         
         
        
        <a class="item" data-title="Tasks" href="/docs/tasks/"></a>

	
	
		
		
	<div class="item" data-title="Install Tools">
		<div class="container">
		
		
	
	
		
		
<a class="item" data-title="Install and Set Up kubectl" href="/docs/tasks/tools/install-kubectl/"></a>

		
	
		
		
<a class="item" data-title="Install Minikube" href="/docs/tasks/tools/install-minikube/"></a>

		
	
		
		
<a class="item" data-title="Installing kubeadm" href="/docs/tasks/tools/install-kubeadm/"></a>

		
	

		</div>
	</div>

		
	
		
		
	<div class="item" data-title="Administer a Cluster">
		<div class="container">
		
		
	
	
		
		
	<div class="item" data-title="Administration with kubeadm">
		<div class="container">
		
		
	
	
		
		
<a class="item" data-title="Upgrading kubeadm HA clusters from 1.9.x to 1.9.y" href="/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade-ha/"></a>

		
	
		
		
<a class="item" data-title="Upgrading kubeadm clusters from 1.7 to 1.8" href="/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade-1-8/"></a>

		
	
		
		
<a class="item" data-title="Upgrading kubeadm clusters from v1.10 to v1.11" href="/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade-1-11/"></a>

		
	
		
		
<a class="item" data-title="Upgrading/downgrading kubeadm clusters between v1.8 to v1.9" href="/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade-1-9/"></a>

		
	

		</div>
	</div>

		
	
		
		
	<div class="item" data-title="Manage Memory, CPU, and API Resources">
		<div class="container">
		
		
	
	
		
		
<a class="item" data-title="Configure Default Memory Requests and Limits for a Namespace" href="/docs/tasks/administer-cluster/manage-resources/memory-default-namespace/"></a>

		
	
		
		
<a class="item" data-title="Configure Default CPU Requests and Limits for a Namespace" href="/docs/tasks/administer-cluster/manage-resources/cpu-default-namespace/"></a>

		
	
		
		
<a class="item" data-title="Configure Minimum and Maximum Memory Constraints for a Namespace" href="/docs/tasks/administer-cluster/manage-resources/memory-constraint-namespace/"></a>

		
	
		
		
<a class="item" data-title="Configure Minimum and Maximum CPU Constraints for a Namespace" href="/docs/tasks/administer-cluster/manage-resources/cpu-constraint-namespace/"></a>

		
	
		
		
<a class="item" data-title="Configure Memory and CPU Quotas for a Namespace" href="/docs/tasks/administer-cluster/manage-resources/quota-memory-cpu-namespace/"></a>

		
	
		
		
<a class="item" data-title="Configure a Pod Quota for a Namespace" href="/docs/tasks/administer-cluster/manage-resources/quota-pod-namespace/"></a>

		
	

		</div>
	</div>

		
	
		
		
	<div class="item" data-title="Install a Network Policy Provider">
		<div class="container">
		
		
	
	
		
		
<a class="item" data-title="Use Calico for NetworkPolicy" href="/docs/tasks/administer-cluster/network-policy-provider/calico-network-policy/"></a>

		
	
		
		
<a class="item" data-title="Use Cilium for NetworkPolicy" href="/docs/tasks/administer-cluster/network-policy-provider/cilium-network-policy/"></a>

		
	
		
		
<a class="item" data-title="Use Kube-router for NetworkPolicy" href="/docs/tasks/administer-cluster/network-policy-provider/kube-router-network-policy/"></a>

		
	
		
		
<a class="item" data-title="Romana for NetworkPolicy" href="/docs/tasks/administer-cluster/network-policy-provider/romana-network-policy/"></a>

		
	
		
		
<a class="item" data-title="Weave Net for NetworkPolicy" href="/docs/tasks/administer-cluster/network-policy-provider/weave-network-policy/"></a>

		
	

		</div>
	</div>

		
	
		
		
<a class="item" data-title="Access Clusters Using the Kubernetes API" href="/docs/tasks/administer-cluster/access-cluster-api/"></a>

		
	
		
		
<a class="item" data-title="Access Services Running on Clusters" href="/docs/tasks/administer-cluster/access-cluster-services/"></a>

		
	
		
		
<a class="item" data-title="Advertise Extended Resources for a Node" href="/docs/tasks/administer-cluster/extended-resource-node/"></a>

		
	
		
		
<a class="item" data-title="Autoscale the DNS Service in a Cluster" href="/docs/tasks/administer-cluster/dns-horizontal-autoscaling/"></a>

		
	
		
		
<a class="item" data-title="Change the Reclaim Policy of a PersistentVolume" href="/docs/tasks/administer-cluster/change-pv-reclaim-policy/"></a>

		
	
		
		
<a class="item" data-title="Change the default StorageClass" href="/docs/tasks/administer-cluster/change-default-storage-class/"></a>

		
	
		
		
<a class="item" data-title="Cluster Management" href="/docs/tasks/administer-cluster/cluster-management/"></a>

		
	
		
		
<a class="item" data-title="Configure Multiple Schedulers" href="/docs/tasks/administer-cluster/configure-multiple-schedulers/"></a>

		
	
		
		
<a class="item" data-title="Configure Out Of Resource Handling" href="/docs/tasks/administer-cluster/out-of-resource/"></a>

		
	
		
		
<a class="item" data-title="Configure Quotas for API Objects" href="/docs/tasks/administer-cluster/quota-api-object/"></a>

		
	
		
		
<a class="item" data-title="Control CPU Management Policies on the Node" href="/docs/tasks/administer-cluster/cpu-management-policies/"></a>

		
	
		
		
<a class="item" data-title="Customizing DNS Service" href="/docs/tasks/administer-cluster/dns-custom-nameservers/"></a>

		
	
		
		
<a class="item" data-title="Debugging DNS Resolution" href="/docs/tasks/administer-cluster/dns-debugging-resolution/"></a>

		
	
		
		
<a class="item" data-title="Declare Network Policy" href="/docs/tasks/administer-cluster/declare-network-policy/"></a>

		
	
		
		
<a class="item" data-title="Developing Cloud Controller Manager" href="/docs/tasks/administer-cluster/developing-cloud-controller-manager/"></a>

		
	
		
		
<a class="item" data-title="Encrypting Secret Data at Rest" href="/docs/tasks/administer-cluster/encrypt-data/"></a>

		
	
		
		
<a class="item" data-title="Guaranteed Scheduling For Critical Add-On Pods" href="/docs/tasks/administer-cluster/guaranteed-scheduling-critical-addon-pods/"></a>

		
	
		
		
<a class="item" data-title="IP Masquerade Agent User Guide" href="/docs/tasks/administer-cluster/ip-masq-agent/"></a>

		
	
		
		
<a class="item" data-title="Kubernetes Cloud Controller Manager" href="/docs/tasks/administer-cluster/running-cloud-controller/"></a>

		
	
		
		
<a class="item" data-title="Limit Storage Consumption" href="/docs/tasks/administer-cluster/limit-storage-consumption/"></a>

		
	
		
		
<a class="item" data-title="Namespaces Walkthrough" href="/docs/tasks/administer-cluster/namespaces-walkthrough/"></a>

		
	
		
		
<a class="item" data-title="Operating etcd clusters for Kubernetes" href="/docs/tasks/administer-cluster/configure-upgrade-etcd/"></a>

		
	
		
		
<a class="item" data-title="Reconfigure a Node&#39;s Kubelet in a Live Cluster" href="/docs/tasks/administer-cluster/reconfigure-kubelet/"></a>

		
	
		
		
<a class="item" data-title="Reserve Compute Resources for System Daemons" href="/docs/tasks/administer-cluster/reserve-compute-resources/"></a>

		
	
		
		
<a class="item" data-title="Safely Drain a Node while Respecting Application SLOs" href="/docs/tasks/administer-cluster/safely-drain-node/"></a>

		
	
		
		
<a class="item" data-title="Securing a Cluster" href="/docs/tasks/administer-cluster/securing-a-cluster/"></a>

		
	
		
		
<a class="item" data-title="Set Kubelet parameters via a config file" href="/docs/tasks/administer-cluster/kubelet-config-file/"></a>

		
	
		
		
<a class="item" data-title="Set up High-Availability Kubernetes Masters" href="/docs/tasks/administer-cluster/highly-available-master/"></a>

		
	
		
		
<a class="item" data-title="Set up a Highly Availabile etcd Cluster With kubeadm" href="/docs/tasks/administer-cluster/setup-ha-etcd-with-kubeadm/"></a>

		
	
		
		
<a class="item" data-title="Share a Cluster with Namespaces" href="/docs/tasks/administer-cluster/namespaces/"></a>

		
	
		
		
<a class="item" data-title="Static Pods" href="/docs/tasks/administer-cluster/static-pod/"></a>

		
	
		
		
<a class="item" data-title="Storage Object in Use Protection" href="/docs/tasks/administer-cluster/storage-object-in-use-protection/"></a>

		
	
		
		
<a class="item" data-title="Using CoreDNS for Service Discovery" href="/docs/tasks/administer-cluster/coredns/"></a>

		
	
		
		
<a class="item" data-title="Using a KMS provider for data encryption" href="/docs/tasks/administer-cluster/kms-provider/"></a>

		
	
		
		
<a class="item" data-title="Using sysctls in a Kubernetes Cluster" href="/docs/tasks/administer-cluster/sysctl-cluster/"></a>

		
	

		</div>
	</div>

		
	
		
		
	<div class="item" data-title="Configure Pods and Containers">
		<div class="container">
		
		
	
	
		
		
<a class="item" data-title="Assign Memory Resources to Containers and Pods" href="/docs/tasks/configure-pod-container/assign-memory-resource/"></a>

		
	
		
		
<a class="item" data-title="Assign CPU Resources to Containers and Pods" href="/docs/tasks/configure-pod-container/assign-cpu-resource/"></a>

		
	
		
		
<a class="item" data-title="Configure Quality of Service for Pods" href="/docs/tasks/configure-pod-container/quality-service-pod/"></a>

		
	
		
		
<a class="item" data-title="Assign Extended Resources to a Container" href="/docs/tasks/configure-pod-container/extended-resource/"></a>

		
	
		
		
<a class="item" data-title="Configure a Pod to Use a Volume for Storage" href="/docs/tasks/configure-pod-container/configure-volume-storage/"></a>

		
	
		
		
<a class="item" data-title="Configure a Pod to Use a PersistentVolume for Storage" href="/docs/tasks/configure-pod-container/configure-persistent-volume-storage/"></a>

		
	
		
		
<a class="item" data-title="Configure a Pod to Use a Projected Volume for Storage" href="/docs/tasks/configure-pod-container/configure-projected-volume-storage/"></a>

		
	
		
		
<a class="item" data-title="Configure a Security Context for a Pod or Container" href="/docs/tasks/configure-pod-container/security-context/"></a>

		
	
		
		
<a class="item" data-title="Configure Service Accounts for Pods" href="/docs/tasks/configure-pod-container/configure-service-account/"></a>

		
	
		
		
<a class="item" data-title="Pull an Image from a Private Registry" href="/docs/tasks/configure-pod-container/pull-image-private-registry/"></a>

		
	
		
		
<a class="item" data-title="Configure Liveness and Readiness Probes" href="/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/"></a>

		
	
		
		
<a class="item" data-title="Assign Pods to Nodes" href="/docs/tasks/configure-pod-container/assign-pods-nodes/"></a>

		
	
		
		
<a class="item" data-title="Configure Pod Initialization" href="/docs/tasks/configure-pod-container/configure-pod-initialization/"></a>

		
	
		
		
<a class="item" data-title="Attach Handlers to Container Lifecycle Events" href="/docs/tasks/configure-pod-container/attach-handler-lifecycle-event/"></a>

		
	
		
		
<a class="item" data-title="Configure a Pod to Use a ConfigMap" href="/docs/tasks/configure-pod-container/configure-pod-configmap/"></a>

		
	
		
		
<a class="item" data-title="Share Process Namespace between Containers in a Pod" href="/docs/tasks/configure-pod-container/share-process-namespace/"></a>

		
	
		
		
<a class="item" data-title="Translate a Docker Compose File to Kubernetes Resources" href="/docs/tasks/configure-pod-container/translate-compose-kubernetes/"></a>

		
	

		</div>
	</div>

		
	
		
		
	<div class="item" data-title="Inject Data Into Applications">
		<div class="container">
		
		
	
	
		
		
<a class="item" data-title="Define a Command and Arguments for a Container" href="/docs/tasks/inject-data-application/define-command-argument-container/"></a>

		
	
		
		
<a class="item" data-title="Define Environment Variables for a Container" href="/docs/tasks/inject-data-application/define-environment-variable-container/"></a>

		
	
		
		
<a class="item" data-title="Expose Pod Information to Containers Through Environment Variables" href="/docs/tasks/inject-data-application/environment-variable-expose-pod-information/"></a>

		
	
		
		
<a class="item" data-title="Expose Pod Information to Containers Through Files" href="/docs/tasks/inject-data-application/downward-api-volume-expose-pod-information/"></a>

		
	
		
		
<a class="item" data-title="Distribute Credentials Securely Using Secrets" href="/docs/tasks/inject-data-application/distribute-credentials-secure/"></a>

		
	
		
		
<a class="item" data-title="Inject Information into Pods Using a PodPreset" href="/docs/tasks/inject-data-application/podpreset/"></a>

		
	

		</div>
	</div>

		
	
		
		
	<div class="item" data-title="Run Applications">
		<div class="container">
		
		
	
	
		
		
<a class="item" data-title="Run a Stateless Application Using a Deployment" href="/docs/tasks/run-application/run-stateless-application-deployment/"></a>

		
	
		
		
<a class="item" data-title="Run a Single-Instance Stateful Application" href="/docs/tasks/run-application/run-single-instance-stateful-application/"></a>

		
	
		
		
<a class="item" data-title="Run a Replicated Stateful Application" href="/docs/tasks/run-application/run-replicated-stateful-application/"></a>

		
	
		
		
<a class="item" data-title="Update API Objects in Place Using kubectl patch" href="/docs/tasks/run-application/update-api-object-kubectl-patch/"></a>

		
	
		
		
<a class="item" data-title="Scale a StatefulSet" href="/docs/tasks/run-application/scale-stateful-set/"></a>

		
	
		
		
<a class="item" data-title="Delete a StatefulSet" href="/docs/tasks/run-application/delete-stateful-set/"></a>

		
	
		
		
<a class="item" data-title="Force Delete StatefulSet Pods" href="/docs/tasks/run-application/force-delete-stateful-set-pod/"></a>

		
	
		
		
<a class="item" data-title="Perform Rolling Update Using a Replication Controller" href="/docs/tasks/run-application/rolling-update-replication-controller/"></a>

		
	
		
		
<a class="item" data-title="Horizontal Pod Autoscaler" href="/docs/tasks/run-application/horizontal-pod-autoscale/"></a>

		
	
		
		
<a class="item" data-title="Horizontal Pod Autoscaler Walkthrough" href="/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/"></a>

		
	
		
		
<a class="item" data-title="Specifying a Disruption Budget for your Application" href="/docs/tasks/run-application/configure-pdb/"></a>

		
	

		</div>
	</div>

		
	
		
		
	<div class="item" data-title="Run Jobs">
		<div class="container">
		
		
	
	
		
		
<a class="item" data-title="Running automated tasks with cron jobs" href="/docs/tasks/job/automated-tasks-with-cron-jobs/"></a>

		
	
		
		
<a class="item" data-title="Parallel Processing using Expansions" href="/docs/tasks/job/parallel-processing-expansion/"></a>

		
	
		
		
<a class="item" data-title="Coarse Parallel Processing Using a Work Queue" href="/docs/tasks/job/coarse-parallel-processing-work-queue/"></a>

		
	
		
		
<a class="item" data-title="Fine Parallel Processing Using a Work Queue" href="/docs/tasks/job/fine-parallel-processing-work-queue/"></a>

		
	

		</div>
	</div>

		
	
		
		
	<div class="item" data-title="Access Applications in a Cluster">
		<div class="container">
		
		
	
	
		
		
<a class="item" data-title="Web UI (Dashboard)" href="/docs/tasks/access-application-cluster/web-ui-dashboard/"></a>

		
	
		
		
<a class="item" data-title="Accessing Clusters" href="/docs/tasks/access-application-cluster/access-cluster/"></a>

		
	
		
		
<a class="item" data-title="Configure Access to Multiple Clusters" href="/docs/tasks/access-application-cluster/configure-access-multiple-clusters/"></a>

		
	
		
		
<a class="item" data-title="Use Port Forwarding to Access Applications in a Cluster" href="/docs/tasks/access-application-cluster/port-forward-access-application-cluster/"></a>

		
	
		
		
<a class="item" data-title="Provide Load-Balanced Access to an Application in a Cluster" href="/docs/tasks/access-application-cluster/load-balance-access-application-cluster/"></a>

		
	
		
		
<a class="item" data-title="Use a Service to Access an Application in a Cluster" href="/docs/tasks/access-application-cluster/service-access-application-cluster/"></a>

		
	
		
		
<a class="item" data-title="Connect a Front End to a Back End Using a Service" href="/docs/tasks/access-application-cluster/connecting-frontend-backend/"></a>

		
	
		
		
<a class="item" data-title="Create an External Load Balancer" href="/docs/tasks/access-application-cluster/create-external-load-balancer/"></a>

		
	
		
		
<a class="item" data-title="Configure Your Cloud Provider&#39;s Firewalls" href="/docs/tasks/access-application-cluster/configure-cloud-provider-firewall/"></a>

		
	
		
		
<a class="item" data-title="List All Container Images Running in a Cluster" href="/docs/tasks/access-application-cluster/list-all-running-container-images/"></a>

		
	
		
		
<a class="item" data-title="Communicate Between Containers in the Same Pod Using a Shared Volume" href="/docs/tasks/access-application-cluster/communicate-containers-same-pod-shared-volume/"></a>

		
	
		
		
<a class="item" data-title="Configure DNS for a Cluster" href="/docs/tasks/access-application-cluster/configure-dns-cluster/"></a>

		
	

		</div>
	</div>

		
	
		
		
	<div class="item" data-title="Monitor, Log, and Debug">
		<div class="container">
		
		
	
	
		
		
<a class="item" data-title="Application Introspection and Debugging" href="/docs/tasks/debug-application-cluster/debug-application-introspection/"></a>

		
	
		
		
<a class="item" data-title="Auditing" href="/docs/tasks/debug-application-cluster/audit/"></a>

		
	
		
		
<a class="item" data-title="Core metrics pipeline" href="/docs/tasks/debug-application-cluster/core-metrics-pipeline/"></a>

		
	
		
		
<a class="item" data-title="Debug Init Containers" href="/docs/tasks/debug-application-cluster/debug-init-containers/"></a>

		
	
		
		
<a class="item" data-title="Debug Pods and Replication Controllers" href="/docs/tasks/debug-application-cluster/debug-pod-replication-controller/"></a>

		
	
		
		
<a class="item" data-title="Debug Services" href="/docs/tasks/debug-application-cluster/debug-service/"></a>

		
	
		
		
<a class="item" data-title="Debug a StatefulSet" href="/docs/tasks/debug-application-cluster/debug-stateful-set/"></a>

		
	
		
		
<a class="item" data-title="Debugging Kubernetes nodes with crictl" href="/docs/tasks/debug-application-cluster/crictl/"></a>

		
	
		
		
<a class="item" data-title="Determine the Reason for Pod Failure" href="/docs/tasks/debug-application-cluster/determine-reason-pod-failure/"></a>

		
	
		
		
<a class="item" data-title="Developing and debugging services locally" href="/docs/tasks/debug-application-cluster/local-debugging/"></a>

		
	
		
		
<a class="item" data-title="Events in Stackdriver" href="/docs/tasks/debug-application-cluster/events-stackdriver/"></a>

		
	
		
		
<a class="item" data-title="Get a Shell to a Running Container" href="/docs/tasks/debug-application-cluster/get-shell-running-container/"></a>

		
	
		
		
<a class="item" data-title="Logging Using Elasticsearch and Kibana" href="/docs/tasks/debug-application-cluster/logging-elasticsearch-kibana/"></a>

		
	
		
		
<a class="item" data-title="Logging Using Stackdriver" href="/docs/tasks/debug-application-cluster/logging-stackdriver/"></a>

		
	
		
		
<a class="item" data-title="Monitor Node Health" href="/docs/tasks/debug-application-cluster/monitor-node-health/"></a>

		
	
		
		
<a class="item" data-title="Tools for Monitoring Compute, Storage, and Network Resources" href="/docs/tasks/debug-application-cluster/resource-usage-monitoring/"></a>

		
	
		
		
<a class="item" data-title="Troubleshoot Applications" href="/docs/tasks/debug-application-cluster/debug-application/"></a>

		
	
		
		
<a class="item" data-title="Troubleshoot Clusters" href="/docs/tasks/debug-application-cluster/debug-cluster/"></a>

		
	
		
		
<a class="item" data-title="Troubleshooting" href="/docs/tasks/debug-application-cluster/troubleshooting/"></a>

		
	

		</div>
	</div>

		
	
		
		
	<div class="item" data-title="Extend Kubernetes">
		<div class="container">
		
		
	
	
		
		
<a class="item" data-title="Configure the aggregation layer" href="/docs/tasks/access-kubernetes-api/configure-aggregation-layer/"></a>

		
	
		
		
	<div class="item" data-title="Use Custom Resources">
		<div class="container">
		
		
	
	
		
		
<a class="item" data-title="Extend the Kubernetes API with CustomResourceDefinitions" href="/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definitions/"></a>

		
	
		
		
<a class="item" data-title="Versions of CustomResourceDefinitions" href="/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definition-versioning/"></a>

		
	
		
		
<a class="item" data-title="Migrate a ThirdPartyResource to CustomResourceDefinition" href="/docs/tasks/access-kubernetes-api/custom-resources/migrate-third-party-resource/"></a>

		
	

		</div>
	</div>

		
	
		
		
<a class="item" data-title="Setup an extension API server" href="/docs/tasks/access-kubernetes-api/setup-extension-api-server/"></a>

		
	
		
		
<a class="item" data-title="Use an HTTP Proxy to Access the Kubernetes API" href="/docs/tasks/access-kubernetes-api/http-proxy-access-api/"></a>

		
	

		</div>
	</div>

		
	
		
		
	<div class="item" data-title="TLS">
		<div class="container">
		
		
	
	
		
		
<a class="item" data-title="Certificate Rotation" href="/docs/tasks/tls/certificate-rotation/"></a>

		
	
		
		
<a class="item" data-title="Manage TLS Certificates in a Cluster" href="/docs/tasks/tls/managing-tls-in-a-cluster/"></a>

		
	

		</div>
	</div>

		
	
		
		
	<div class="item" data-title="Federation - Run an App on Multiple Clusters">
		<div class="container">
		
		
	
	
		
		
<a class="item" data-title="Cross-cluster Service Discovery using Federated Services" href="/docs/tasks/federation/federation-service-discovery/"></a>

		
	
		
		
<a class="item" data-title="Set up Cluster Federation with Kubefed" href="/docs/tasks/federation/set-up-cluster-federation-kubefed/"></a>

		
	
		
		
<a class="item" data-title="Set up CoreDNS as DNS provider for Cluster Federation" href="/docs/tasks/federation/set-up-coredns-provider-federation/"></a>

		
	
		
		
<a class="item" data-title="Set up placement policies in Federation" href="/docs/tasks/federation/set-up-placement-policies-federation/"></a>

		
	

		</div>
	</div>

		
	
		
		
	<div class="item" data-title="Manage Cluster Daemons">
		<div class="container">
		
		
	
	
		
		
<a class="item" data-title="Perform a Rolling Update on a DaemonSet" href="/docs/tasks/manage-daemon/update-daemon-set/"></a>

		
	
		
		
<a class="item" data-title="Performing a Rollback on a DaemonSet" href="/docs/tasks/manage-daemon/rollback-daemon-set/"></a>

		
	

		</div>
	</div>

		
	
		
		
	<div class="item" data-title="Install Service Catalog">
		<div class="container">
		
		
	
	
		
		
<a class="item" data-title="Install Service Catalog using Helm" href="/docs/tasks/service-catalog/install-service-catalog-using-helm/"></a>

		
	
		
		
<a class="item" data-title="Install Service Catalog using SC" href="/docs/tasks/service-catalog/install-service-catalog-using-sc/"></a>

		
	

		</div>
	</div>

		
	
		
		
	<div class="item" data-title="Federation - Run an App on Multiple Clusters">
		<div class="container">
		
		
	
	
		
		
<a class="item" data-title="Federated Cluster" href="/docs/tasks/administer-federation/cluster/"></a>

		
	
		
		
<a class="item" data-title="Federated ConfigMap" href="/docs/tasks/administer-federation/configmap/"></a>

		
	
		
		
<a class="item" data-title="Federated DaemonSet" href="/docs/tasks/administer-federation/daemonset/"></a>

		
	
		
		
<a class="item" data-title="Federated Deployment" href="/docs/tasks/administer-federation/deployment/"></a>

		
	
		
		
<a class="item" data-title="Federated Events" href="/docs/tasks/administer-federation/events/"></a>

		
	
		
		
<a class="item" data-title="Federated Horizontal Pod Autoscalers (HPA)" href="/docs/tasks/administer-federation/hpa/"></a>

		
	
		
		
<a class="item" data-title="Federated Ingress" href="/docs/tasks/administer-federation/ingress/"></a>

		
	
		
		
<a class="item" data-title="Federated Jobs" href="/docs/tasks/administer-federation/job/"></a>

		
	
		
		
<a class="item" data-title="Federated Namespaces" href="/docs/tasks/administer-federation/namespaces/"></a>

		
	
		
		
<a class="item" data-title="Federated ReplicaSets" href="/docs/tasks/administer-federation/replicaset/"></a>

		
	
		
		
<a class="item" data-title="Federated Secrets" href="/docs/tasks/administer-federation/secret/"></a>

		
	

		</div>
	</div>

		
	
		
		
<a class="item" data-title="Extend kubectl with plugins" href="/docs/tasks/extend-kubectl/kubectl-plugins/"></a>

		
	
		
		
<a class="item" data-title="Manage HugePages" href="/docs/tasks/manage-hugepages/scheduling-hugepages/"></a>

		
	
		
		
<a class="item" data-title="Schedule GPUs" href="/docs/tasks/manage-gpus/scheduling-gpus/"></a>

		
	






     </div> 
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
</div> 

			<div id="docsContent">
				
<p><a href="/docs/editdocs#docs/tasks/federation/set-up-placement-policies-federation.md" id="editPageButton">Edit This Page</a></p>

<h1>Set up placement policies in Federation</h1>




<p><strong>Note:</strong> <code>Federation V1</code>, the current Kubernetes federation API which reuses the Kubernetes API resources &lsquo;as is&rsquo;, is currently considered alpha for many of its features, and there is no clear path to evolve the API to GA. However, there is a <code>Federation V2</code> effort in progress to implement a dedicated federation API apart from the Kubernetes API. The details can be found at <a href="https://github.com/kubernetes/community/tree/master/sig-multicluster" target="_blank">sig-multicluster community page</a>.</p>

<p>This page shows how to enforce policy-based placement decisions over Federated
resources using an external policy engine.</p>











<ul id="markdown-toc">










<li><a href="#before-you-begin">Before you begin</a></li>












<li><a href="#deploying-federation-and-configuring-an-external-policy-engine">Deploying Federation and configuring an external policy engine</a></li>




<li><a href="#deploying-an-external-policy-engine">Deploying an external policy engine</a></li>




<li><a href="#configuring-placement-policies-via-configmaps">Configuring placement policies via ConfigMaps</a></li>




<li><a href="#testing-placement-policies">Testing placement policies</a></li>



























</ul>



<h2 id="before-you-begin">Before you begin</h2>
<p>You need to have a running Kubernetes cluster (which is referenced as host
cluster). Please see one of the <a href="/docs/setup/">getting started</a>
guides for installation instructions for your platform.</p>




<h2 id="deploying-federation-and-configuring-an-external-policy-engine">Deploying Federation and configuring an external policy engine</h2>

<p>The Federation control plane can be deployed using <code>kubefed init</code>.</p>

<p>After deploying the Federation control plane, you must configure an Admission
Controller in the Federation API server that enforces placement decisions
received from the external policy engine.</p>

<pre><code>kubectl create -f scheduling-policy-admission.yaml
</code></pre>

<p>Shown below is an example ConfigMap for the Admission Controller:</p>

<table class="includecode" id="scheduling-policy-admission-yaml">
    <thead>
        <tr>
            <th>
                <a href="https://github.com/kubernetes/website/blob/master/content/en/docs/tasks/federation/scheduling-policy-admission.yaml" download="scheduling-policy-admission.yaml">
                    <code>scheduling-policy-admission.yaml docs/tasks/federation</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('scheduling-policy-admission-yaml')" title="Copy scheduling-policy-admission.yaml to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>ConfigMap<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>admission<span style="color:#bbb">
</span><span style="color:#bbb">  </span>namespace:<span style="color:#bbb"> </span>federation-system<span style="color:#bbb">
</span><span style="color:#bbb"></span>data:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>config.yml:<span style="color:#bbb"> </span><span style="color:#b44;font-style:italic">|
</span><span style="color:#b44;font-style:italic">    apiVersion: apiserver.k8s.io/v1alpha1
</span><span style="color:#b44;font-style:italic">    kind: AdmissionConfiguration
</span><span style="color:#b44;font-style:italic">    plugins:
</span><span style="color:#b44;font-style:italic">    - name: SchedulingPolicy
</span><span style="color:#b44;font-style:italic">      path: /etc/kubernetes/admission/scheduling-policy-config.yml</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>scheduling-policy-config.yml:<span style="color:#bbb"> </span><span style="color:#b44;font-style:italic">|
</span><span style="color:#b44;font-style:italic">    kubeconfig: /etc/kubernetes/admission/opa-kubeconfig</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>opa-kubeconfig:<span style="color:#bbb"> </span><span style="color:#b44;font-style:italic">|
</span><span style="color:#b44;font-style:italic">    clusters:
</span><span style="color:#b44;font-style:italic">      - name: opa-api
</span><span style="color:#b44;font-style:italic">        cluster:
</span><span style="color:#b44;font-style:italic">          server: http://opa.federation-system.svc.cluster.local:8181/v0/data/kubernetes/placement
</span><span style="color:#b44;font-style:italic">    users:
</span><span style="color:#b44;font-style:italic">      - name: scheduling-policy
</span><span style="color:#b44;font-style:italic">        user:
</span><span style="color:#b44;font-style:italic">          token: deadbeefsecret
</span><span style="color:#b44;font-style:italic">    contexts:
</span><span style="color:#b44;font-style:italic">      - name: default
</span><span style="color:#b44;font-style:italic">        context:
</span><span style="color:#b44;font-style:italic">          cluster: opa-api
</span><span style="color:#b44;font-style:italic">          user: scheduling-policy
</span><span style="color:#b44;font-style:italic">    current-context: default</span><span style="color:#bbb">
</span><span style="color:#bbb"></span></code></pre></div>  </td>
        </tr>
    </tbody>
</table>

<p>The ConfigMap contains three files:</p>

<ul>
<li><code>config.yml</code> specifies the location of the <code>SchedulingPolicy</code> Admission
Controller config file.</li>
<li><code>scheduling-policy-config.yml</code> specifies the location of the kubeconfig file
required to contact the external policy engine. This file can also include a
<code>retryBackoff</code> value that controls the initial retry backoff delay in
milliseconds.</li>
<li><code>opa-kubeconfig</code> is a standard kubeconfig containing the URL and credentials
needed to contact the external policy engine.</li>
</ul>

<p>Edit the Federation API server deployment to enable the <code>SchedulingPolicy</code>
Admission Controller.</p>

<pre><code>kubectl -n federation-system edit deployment federation-apiserver
</code></pre>

<p>Update the Federation API server command line arguments to enable the Admission
Controller and mount the ConfigMap into the container. If there&rsquo;s an existing
<code>--enable-admission-plugins</code> flag, append <code>,SchedulingPolicy</code> instead of adding
another line.</p>

<pre><code>--enable-admission-plugins=SchedulingPolicy
--admission-control-config-file=/etc/kubernetes/admission/config.yml
</code></pre>

<p>Add the following volume to the Federation API server pod:</p>

<pre><code>- name: admission-config
  configMap:
    name: admission
</code></pre>

<p>Add the following volume mount the Federation API server <code>apiserver</code> container:</p>

<pre><code>volumeMounts:
- name: admission-config
  mountPath: /etc/kubernetes/admission
</code></pre>

<h2 id="deploying-an-external-policy-engine">Deploying an external policy engine</h2>

<p>The <a href="http://openpolicyagent.org" target="_blank">Open Policy Agent (OPA)</a> is an open source,
general-purpose policy engine that you can use to enforce policy-based placement
decisions in the Federation control plane.</p>

<p>Create a Service in the host cluster to contact the external policy engine:</p>

<pre><code>kubectl create -f policy-engine-service.yaml
</code></pre>

<p>Shown below is an example Service for OPA.</p>

<table class="includecode" id="policy-engine-service-yaml">
    <thead>
        <tr>
            <th>
                <a href="https://github.com/kubernetes/website/blob/master/content/en/docs/tasks/federation/policy-engine-service.yaml" download="policy-engine-service.yaml">
                    <code>policy-engine-service.yaml docs/tasks/federation</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('policy-engine-service-yaml')" title="Copy policy-engine-service.yaml to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">kind:<span style="color:#bbb"> </span>Service<span style="color:#bbb">
</span><span style="color:#bbb"></span>apiVersion:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>opa<span style="color:#bbb">
</span><span style="color:#bbb">  </span>namespace:<span style="color:#bbb"> </span>federation-system<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>selector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>app:<span style="color:#bbb"> </span>opa<span style="color:#bbb">
</span><span style="color:#bbb">  </span>ports:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>http<span style="color:#bbb">
</span><span style="color:#bbb">    </span>protocol:<span style="color:#bbb"> </span>TCP<span style="color:#bbb">
</span><span style="color:#bbb">    </span>port:<span style="color:#bbb"> </span><span style="color:#666">8181</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>targetPort:<span style="color:#bbb"> </span><span style="color:#666">8181</span></code></pre></div>  </td>
        </tr>
    </tbody>
</table>

<p>Create a Deployment in the host cluster with the Federation control plane:</p>

<pre><code>kubectl create -f policy-engine-deployment.yaml
</code></pre>

<p>Shown below is an example Deployment for OPA.</p>

<table class="includecode" id="policy-engine-deployment-yaml">
    <thead>
        <tr>
            <th>
                <a href="https://github.com/kubernetes/website/blob/master/content/en/docs/tasks/federation/policy-engine-deployment.yaml" download="policy-engine-deployment.yaml">
                    <code>policy-engine-deployment.yaml docs/tasks/federation</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('policy-engine-deployment-yaml')" title="Copy policy-engine-deployment.yaml to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>apps/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>Deployment<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>labels:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>app:<span style="color:#bbb"> </span>opa<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>opa<span style="color:#bbb">
</span><span style="color:#bbb">  </span>namespace:<span style="color:#bbb"> </span>federation-system<span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>replicas:<span style="color:#bbb"> </span><span style="color:#666">1</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>template:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>labels:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>app:<span style="color:#bbb"> </span>opa<span style="color:#bbb">
</span><span style="color:#bbb">      </span>name:<span style="color:#bbb"> </span>opa<span style="color:#bbb">
</span><span style="color:#bbb">    </span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>opa<span style="color:#bbb">
</span><span style="color:#bbb">          </span>image:<span style="color:#bbb"> </span>openpolicyagent/opa:<span style="color:#666">0.4</span>.<span style="color:#666">10</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span>args:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>-<span style="color:#bbb"> </span><span style="color:#b44">&#34;run&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span>-<span style="color:#bbb"> </span><span style="color:#b44">&#34;--server&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>kube-mgmt<span style="color:#bbb">
</span><span style="color:#bbb">          </span>image:<span style="color:#bbb"> </span>openpolicyagent/kube-mgmt:<span style="color:#666">0.2</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span>args:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>-<span style="color:#bbb"> </span><span style="color:#b44">&#34;-kubeconfig=/srv/kubernetes/kubeconfig&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span>-<span style="color:#bbb"> </span><span style="color:#b44">&#34;-cluster=federation/v1beta1/clusters&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span>volumeMounts:<span style="color:#bbb">
</span><span style="color:#bbb">           </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>federation-kubeconfig<span style="color:#bbb">
</span><span style="color:#bbb">             </span>mountPath:<span style="color:#bbb"> </span>/srv/kubernetes<span style="color:#bbb">
</span><span style="color:#bbb">             </span>readOnly:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span>volumes:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>-<span style="color:#bbb"> </span>name:<span style="color:#bbb"> </span>federation-kubeconfig<span style="color:#bbb">
</span><span style="color:#bbb">        </span>secret:<span style="color:#bbb">
</span><span style="color:#bbb">          </span>secretName:<span style="color:#bbb"> </span>federation-controller-manager-kubeconfig<span style="color:#bbb">
</span><span style="color:#bbb"></span></code></pre></div>  </td>
        </tr>
    </tbody>
</table>

<h2 id="configuring-placement-policies-via-configmaps">Configuring placement policies via ConfigMaps</h2>

<p>The external policy engine will discover placement policies created in the
<code>kube-federation-scheduling-policy</code> namespace in the Federation API server.</p>

<p>Create the namespace if it does not already exist:</p>

<pre><code>kubectl --context=federation create namespace kube-federation-scheduling-policy
</code></pre>

<p>Configure a sample policy to test the external policy engine:</p>

<table class="includecode" id="policy-rego">
    <thead>
        <tr>
            <th>
                <a href="https://github.com/kubernetes/website/blob/master/content/en/docs/tasks/federation/policy.rego" download="policy.rego">
                    <code>policy.rego docs/tasks/federation</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('policy-rego')" title="Copy policy.rego to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rego" data-lang="rego"><span style="">#</span> OPA supports a high<span style="color:#666">-</span>level declarative language named Rego <span style="color:#a2f;font-weight:bold">for</span> authoring and
<span style="">#</span> enforcing policies. For more information on Rego, visit
<span style="">#</span> http:<span style="color:#080;font-style:italic">//openpolicyagent.org.
</span><span style="color:#080;font-style:italic"></span>
<span style="">#</span> Rego policies are namespaced by the <span style="color:#b44">&#34;package&#34;</span> directive.
<span style="color:#a2f;font-weight:bold">package</span> kubernetes.placement

<span style="">#</span> Imports provide aliases <span style="color:#a2f;font-weight:bold">for</span> data inside the policy engine. In this <span style="color:#a2f;font-weight:bold">case</span>, the
<span style="">#</span> policy simply refers to <span style="color:#b44">&#34;clusters&#34;</span> below.
<span style="color:#a2f;font-weight:bold">import</span> data.kubernetes.clusters

<span style="">#</span> The <span style="color:#b44">&#34;annotations&#34;</span> rule generates a JSON object containing the key
<span style="">#</span> <span style="color:#b44">&#34;federation.kubernetes.io/replica-set-preferences&#34;</span> mapped to &lt;preferences&gt;.
<span style="">#</span> The preferences values is generated dynamically by OPA when it evaluates the
<span style="">#</span> rule.
<span style="">#</span>
<span style="">#</span> The SchedulingPolicy Admission Controller running inside the Federation API
<span style="">#</span> server will merge these annotations into incoming Federated resources. By
<span style="">#</span> setting replica<span style="color:#666">-</span>set<span style="color:#666">-</span>preferences, we can control the placement of Federated
<span style="">#</span> ReplicaSets.
<span style="">#</span>
<span style="">#</span> Rules are defined to generate JSON values (booleans, strings, objects, etc.)
<span style="">#</span> When OPA evaluates a rule, it generates a value IF all of the expressions in
<span style="">#</span> the body evaluate successfully. All rules can be understood intuitively as
<span style="">#</span> &lt;head&gt; <span style="color:#a2f;font-weight:bold">if</span> &lt;body&gt; where &lt;body&gt; is <span style="color:#a2f;font-weight:bold">true</span> <span style="color:#a2f;font-weight:bold">if</span> &lt;expr<span style="color:#666">-</span><span style="color:#666">1</span>&gt; AND &lt;expr<span style="color:#666">-</span><span style="color:#666">2</span>&gt; AND <span style="color:#666">...</span>
<span style="">#</span> &lt;expr<span style="color:#666">-</span>N&gt; is <span style="color:#a2f;font-weight:bold">true</span> (<span style="color:#a2f;font-weight:bold">for</span> some set of data.)
annotations[<span style="color:#b44">&#34;federation.kubernetes.io/replica-set-preferences&#34;</span>] = preferences {
    input.kind = <span style="color:#b44">&#34;ReplicaSet&#34;</span>
    value = {<span style="color:#b44">&#34;clusters&#34;</span>: cluster_map, <span style="color:#b44">&#34;rebalance&#34;</span>: <span style="color:#a2f;font-weight:bold">true</span>}
    json.marshal(value, preferences)
}

<span style="">#</span> This <span style="color:#b44">&#34;annotations&#34;</span> rule generates a value <span style="color:#a2f;font-weight:bold">for</span> the <span style="color:#b44">&#34;federation.alpha.kubernetes.io/cluster-selector&#34;</span>
<span style="">#</span> annotation.
<span style="">#</span>
<span style="">#</span> In English, the policy asserts that resources in the <span style="color:#b44">&#34;production&#34;</span> namespace
<span style="">#</span> that are not annotated with <span style="color:#b44">&#34;criticality=low&#34;</span> MUST be placed on clusters
<span style="">#</span> labelled with <span style="color:#b44">&#34;on-premises=true&#34;</span>.
annotations[<span style="color:#b44">&#34;federation.alpha.kubernetes.io/cluster-selector&#34;</span>] = selector {
    input.metadata.namespace = <span style="color:#b44">&#34;production&#34;</span>
    not input.metadata.annotations.criticality = <span style="color:#b44">&#34;low&#34;</span>
    json.marshal([{
        <span style="color:#b44">&#34;operator&#34;</span>: <span style="color:#b44">&#34;=&#34;</span>,
        <span style="color:#b44">&#34;key&#34;</span>: <span style="color:#b44">&#34;on-premises&#34;</span>,
        <span style="color:#b44">&#34;values&#34;</span>: <span style="color:#b44">&#34;[true]&#34;</span>,
    }], selector)
}

<span style="">#</span> Generates a set of cluster names that satisfy the incoming Federated
<span style="">#</span> ReplicaSet<span style="">&#39;</span>s requirements. In this <span style="color:#a2f;font-weight:bold">case</span>, just PCI compliance.
replica_set_clusters[cluster_name] {
    clusters[cluster_name]
    not insufficient_pci[cluster_name]
}

<span style="">#</span> Generates a set of clusters that must not be used <span style="color:#a2f;font-weight:bold">for</span> Federated ReplicaSets
<span style="">#</span> that request PCI compliance.
insufficient_pci[cluster_name] {
    clusters[cluster_name]
    input.metadata.annotations[<span style="color:#b44">&#34;requires-pci&#34;</span>] = <span style="color:#b44">&#34;true&#34;</span>
    not pci_clusters[cluster_name]
}

<span style="">#</span> Generates a set of clusters that are PCI certified. In this <span style="color:#a2f;font-weight:bold">case</span>, we assume
<span style="">#</span> clusters are annotated to indicate <span style="color:#a2f;font-weight:bold">if</span> they have passed PCI compliance audits.
pci_clusters[cluster_name] {
    clusters[cluster_name].metadata.annotations[<span style="color:#b44">&#34;pci-certified&#34;</span>] = <span style="color:#b44">&#34;true&#34;</span>
}

<span style="">#</span> Helper rule to generate a mapping of desired clusters to weights. In this
<span style="">#</span> <span style="color:#a2f;font-weight:bold">case</span>, weights are static.
cluster_map[cluster_name] = {<span style="color:#b44">&#34;weight&#34;</span>: <span style="color:#666">1</span>} {
    replica_set_clusters[cluster_name]
}
</code></pre></div>  </td>
        </tr>
    </tbody>
</table>

<p>Shown below is the command to create the sample policy:</p>

<pre><code>kubectl --context=federation -n kube-federation-scheduling-policy create configmap scheduling-policy --from-file=policy.rego
</code></pre>

<p>This sample policy illustrates a few key ideas:</p>

<ul>
<li>Placement policies can refer to any field in Federated resources.</li>
<li>Placement policies can leverage external context (for example, Cluster
metadata) to make decisions.</li>
<li>Administrative policy can be managed centrally.</li>
<li>Policies can define simple interfaces (such as the <code>requires-pci</code> annotation) to
avoid duplicating logic in manifests.</li>
</ul>

<h2 id="testing-placement-policies">Testing placement policies</h2>

<p>Annotate one of the clusters to indicate that it is PCI certified.</p>

<pre><code>kubectl --context=federation annotate clusters cluster-name-1 pci-certified=true
</code></pre>

<p>Deploy a Federated ReplicaSet to test the placement policy.</p>

<table class="includecode" id="replicaset-example-policy-yaml">
    <thead>
        <tr>
            <th>
                <a href="https://github.com/kubernetes/website/blob/master/content/en/docs/tasks/federation/replicaset-example-policy.yaml" download="replicaset-example-policy.yaml">
                    <code>replicaset-example-policy.yaml docs/tasks/federation</code>
                </a>
                <img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('replicaset-example-policy-yaml')" title="Copy replicaset-example-policy.yaml to clipboard">
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">apiVersion:<span style="color:#bbb"> </span>apps/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span>kind:<span style="color:#bbb"> </span>ReplicaSet<span style="color:#bbb">
</span><span style="color:#bbb"></span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>labels:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>app:<span style="color:#bbb"> </span>nginx-pci<span style="color:#bbb">
</span><span style="color:#bbb">  </span>name:<span style="color:#bbb"> </span>nginx-pci<span style="color:#bbb">
</span><span style="color:#bbb">  </span>annotations:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>requires-pci:<span style="color:#bbb"> </span><span style="color:#b44">&#34;true&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>replicas:<span style="color:#bbb"> </span><span style="color:#666">3</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>selector:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>matchLabels:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>app:<span style="color:#bbb"> </span>nginx-pci<span style="color:#bbb">
</span><span style="color:#bbb">  </span>template:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>metadata:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>labels:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>app:<span style="color:#bbb"> </span>nginx-pci<span style="color:#bbb">
</span><span style="color:#bbb">    </span>spec:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>containers:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>-<span style="color:#bbb"> </span>image:<span style="color:#bbb"> </span>nginx<span style="color:#bbb">
</span><span style="color:#bbb">        </span>name:<span style="color:#bbb"> </span>nginx-pci<span style="color:#bbb">
</span><span style="color:#bbb"></span></code></pre></div>  </td>
        </tr>
    </tbody>
</table>

<p>Shown below is the command to deploy a ReplicaSet that <em>does</em> match the policy.</p>

<pre><code>kubectl --context=federation create -f replicaset-example-policy.yaml
</code></pre>

<p>Inspect the ReplicaSet to confirm the appropriate annotations have been applied:</p>

<pre><code>kubectl --context=federation get rs nginx-pci -o jsonpath='{.metadata.annotations}'
</code></pre>



















				<div class="issue-button-container">
					<p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/tasks/federation/set-up-placement-policies-federation.md?pixel" alt="Analytics" /></a></p>
					
					
					<script type="text/javascript">
					PDRTJS_settings_8345992 = {
					"id" : "8345992",
					"unique_id" : "\/docs\/tasks\/federation\/set-up-placement-policies-federation\/",
					"title" : "Set up placement policies in Federation",
					"permalink" : "https:\/\/kubernetes.io\/docs\/tasks\/federation\/set-up-placement-policies-federation\/"
					};
					(function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
					</script>
					<a href="" onclick="window.open('https://github.com/kubernetes/website/issues/new?title=Issue%20with%20' +
					'k8s.io'+window.location.pathname)" class="button issue">Create an Issue</a>
					
					
					
					<a href="/docs/editdocs#docs/tasks/federation/set-up-placement-policies-federation.md" class="button issue">Edit this Page</a>
					
				</div>
			</div>
		</section>
		<footer>
    <main class="light-text">
        <nav>
            
            
            
            <a href="/docs/home/">Documentation</a>
            
            <a href="/blog/">Blog</a>
            
            <a href="/partners/">Partners</a>
            
            <a href="/community/">Community</a>
            
            <a href="/case-studies/">Case Studies</a>
            
        </nav>
        <div class="social">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://discuss.kubernetes.io" class="mailing-list"><span>Forum</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
            <div>
                <a href="/docs/setup/pick-right-solution/" class="button">Get Kubernetes</a>
                <a href="https://git.k8s.io/community/contributors/guide" class="button">Contribute</a>
            </div>
        </div>
        <div id="miceType" class="center">
            &copy; 2018 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a>
        </div>
        <div id="miceType" class="center">
            Copyright &copy; 2018 The Linux Foundation&reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">Trademark Usage page</a>
        </div>
    </main>
</footer>

		<button class="flyout-button" onclick="kub.toggleToc()"></button>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-36037335-10', 'auto');
ga('send', 'pageview');


(function () {
    window.addEventListener('DOMContentLoaded', init)

        
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
        if (!toc) return
            var container = toc.querySelector('.container')

                
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>



	</body>
</html>