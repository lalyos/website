<!DOCTYPE html>
<html id="docs" lang="en" class="">
	<head>
	<meta charset="utf-8">
<title>Configuring Kubernetes with Salt - Kubernetes</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" type="image/png" href="/images/favicon.png">
<link rel="stylesheet" type="text/css" href="/css/base_fonts.css">
<link rel="stylesheet" type="text/css" href="/css/styles.css">
<link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">
<link rel="stylesheet" type="text/css" href="/css/callouts.css">
<link rel="stylesheet" type="text/css" href="/css/custom-jekyll/tags.css">




<meta name="description" content="Configuring Kubernetes with Salt" />
<meta property="og:description" content="Configuring Kubernetes with Salt" />

<meta property="og:url" content="https://kubernetes.io/docs/setup/salt/" />
<meta property="og:title" content="Configuring Kubernetes with Salt - Kubernetes" />

<script
src="https://code.jquery.com/jquery-3.2.1.min.js"
integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
crossorigin="anonymous"></script>
<script
src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
<script src="/js/script.js"></script>
<script src="/js/custom-jekyll/tags.js"></script>


	</head>
	<body>
		<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            
            
            <li><a href="/docs/home/">Documentation</a></li>
            
            <li><a href="/blog/">Blog</a></li>
            
            <li><a href="/partners/">Partners</a></li>
            
            <li><a href="/community/">Community</a></li>
            
            <li><a href="/case-studies/">Case Studies</a></li>
            
            
             <li>
                <a href="#">
                    English <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    <li><a href="/cn/">Chinese</a></li>
                
                </ul>
            </li>
         
            <li>
                <a href="#">
                    v1.11 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    <li><a href="https://kubernetes.io">v1.11</a></li>
                
                    <li><a href="https://kubernetes.io">v1.10</a></li>
                
                    <li><a href="https://v1-9.docs.kubernetes.io">v1.9</a></li>
                
                    <li><a href="https://v1-8.docs.kubernetes.io">v1.8</a></li>
                
                    <li><a href="https://v1-7.docs.kubernetes.io">v1.7</a></li>
                
                </ul>
            </li>
        </ul>
        
        <a href="/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>Try Kubernetes</a>
        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
        <div class="nav-box">
            <h3><a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a></h3>
            <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>
        </div>
        <div class="nav-box">
            <h3><a href="/docs/home/">Documentation</a></h3>
            <p>Learn how to use Kubernetes with the use of walkthroughs, samples, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>
        </div>
        <div class="nav-box">
            <h3><a href="/community/">Community</a></h3>
            <p>If you need help, you can connect with other Kubernetes users and the Kubernetes authors, attend community events, and watch video presentations from around the web.</p>
        </div>
        <div class="nav-box">
            <h3><a href="/blog/">Blog</a></h3>
            <p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>
        </div>
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
            <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
        </div>

        <div class="right">
            <h5 class="github-invite">Explore the community</h5>
            <div class="social">
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://discuss.kubernetes.io" class="mailing-list"><span>Forum</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>

		
		
		<section id="hero" class="light-text no-sub">
			







<h1>Setup</h1>
<h5></h5>










<div id="vendorStrip" class="light-text">
	<ul>
		
		
		<li><a href="/docs/home/">DOCUMENTATION</a></li>
		
		
		<li><a href="/docs/setup/" class="YAH">SETUP</a></li>
		
		
		<li><a href="/docs/concepts/">CONCEPTS</a></li>
		
		
		<li><a href="/docs/tasks/">TASKS</a></li>
		
		
		<li><a href="/docs/tutorials/">TUTORIALS</a></li>
		
		
		<li><a href="/docs/reference/">REFERENCE</a></li>
		
	</ul>
	<div id="searchBox">
		<input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)" autofocus="autofocus">
	</div>
</div>

		</section>
		
		

		<section id="encyclopedia">
			
<div id="docsToc">
     <div class="pi-accordion">
    	
        
        
        
        
        
         
             
                 
             
         
             
                 
                          
                          
                 
             
         
             
         
             
         
             
         
             
         
             
         
             
         
         
        
        <a class="item" data-title="Setup" href="/docs/setup/"></a>

	
	
		
		
	<div class="item" data-title="Bootstrapping Clusters with kubeadm">
		<div class="container">
		
		
	
	
		
		
<a class="item" data-title="Customizing control plane configuration with kubeadm" href="/docs/setup/independent/control-plane-flags/"></a>

		
	
		
		
<a class="item" data-title="Creating Highly Available Clusters with kubeadm" href="/docs/setup/independent/high-availability/"></a>

		
	
		
		
<a class="item" data-title="Creating a single master cluster with kubeadm" href="/docs/setup/independent/create-cluster-kubeadm/"></a>

		
	
		
		
<a class="item" data-title="Troubleshooting kubeadm" href="/docs/setup/independent/troubleshooting-kubeadm/"></a>

		
	

		</div>
	</div>

		
	
		
		
<a class="item" data-title="Building Large Clusters" href="/docs/setup/cluster-large/"></a>

		
	
		
		
<a class="item" data-title="Building from Source" href="/docs/setup/building-from-source/"></a>

		
	
		
		
<a class="item" data-title="Configuring Kubernetes with Salt" href="/docs/setup/salt/"></a>

		
	
		
		
<a class="item" data-title="Creating a Custom Cluster from Scratch" href="/docs/setup/scratch/"></a>

		
	
		
		
	<div class="item" data-title="Custom Cloud Solutions">
		<div class="container">
		
		
	
	
		
		
<a class="item" data-title="CoreOS on AWS or GCE" href="/docs/setup/custom-cloud/coreos/"></a>

		
	
		
		
<a class="item" data-title="Installing Kubernetes On-premises/Cloud Providers with Kubespray" href="/docs/setup/custom-cloud/kubespray/"></a>

		
	
		
		
<a class="item" data-title="Installing Kubernetes on AWS with kops" href="/docs/setup/custom-cloud/kops/"></a>

		
	

		</div>
	</div>

		
	
		
		
	<div class="item" data-title="On-Premises VMs">
		<div class="container">
		
		
	
	
		
		
<a class="item" data-title="Cloudstack" href="/docs/setup/on-premises-vm/cloudstack/"></a>

		
	
		
		
<a class="item" data-title="Kubernetes on DCOS" href="/docs/setup/on-premises-vm/dcos/"></a>

		
	
		
		
<a class="item" data-title="oVirt" href="/docs/setup/on-premises-vm/ovirt/"></a>

		
	

		</div>
	</div>

		
	
		
		
<a class="item" data-title="Picking the Right Solution" href="/docs/setup/pick-right-solution/"></a>

		
	
		
		
<a class="item" data-title="Running Kubernetes Locally via Minikube" href="/docs/setup/minikube/"></a>

		
	
		
		
<a class="item" data-title="Running in Multiple Zones" href="/docs/setup/multiple-zones/"></a>

		
	
		
		
	<div class="item" data-title="Turnkey Cloud Solutions">
		<div class="container">
		
		
	
	
		
		
<a class="item" data-title="Running Kubernetes on AWS EC2" href="/docs/setup/turnkey/aws/"></a>

		
	
		
		
<a class="item" data-title="Running Kubernetes on Alibaba Cloud" href="/docs/setup/turnkey/alibaba-cloud/"></a>

		
	
		
		
<a class="item" data-title="Running Kubernetes on Azure" href="/docs/setup/turnkey/azure/"></a>

		
	
		
		
<a class="item" data-title="Running Kubernetes on CenturyLink Cloud" href="/docs/setup/turnkey/clc/"></a>

		
	
		
		
<a class="item" data-title="Running Kubernetes on Google Compute Engine" href="/docs/setup/turnkey/gce/"></a>

		
	
		
		
<a class="item" data-title="Running Kubernetes on Multiple Clouds with Stackpoint.io" href="/docs/setup/turnkey/stackpoint/"></a>

		
	

		</div>
	</div>

		
	
		
		
<a class="item" data-title="Validate Node Setup" href="/docs/setup/node-conformance/"></a>

		
	






     </div> 
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
</div> 

			<div id="docsContent">
				
<p><a href="/docs/editdocs#docs/setup/salt.md" id="editPageButton">Edit This Page</a></p>

<h1>Configuring Kubernetes with Salt</h1>



<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#salt-cluster-setup">Salt cluster setup</a></li>
<li><a href="#standalone-salt-configuration-on-gce-and-others">Standalone Salt Configuration on GCE and others</a></li>
<li><a href="#salt-security">Salt security</a></li>
<li><a href="#salt-minion-configuration">Salt minion configuration</a></li>
<li><a href="#best-practices">Best Practices</a></li>
<li><a href="#future-enhancements-networking">Future enhancements (Networking)</a></li>
</ul></li>
</ul>
</nav>



<p>The Kubernetes cluster can be configured using Salt.</p>

<p>The Salt scripts are shared across multiple hosting providers and depending on where you host your Kubernetes cluster, you may be using different operating systems and different networking configurations. As a result, it&rsquo;s important to understand some background information before making Salt changes in order to minimize introducing failures for other hosting providers.</p>

<h2 id="salt-cluster-setup">Salt cluster setup</h2>

<p>The <strong>salt-master</strong> service runs on the kubernetes-master <a href="#standalone-salt-configuration-on-gce-and-others">(except on the default GCE and OpenStack-Heat setup)</a>.</p>

<p>The <strong>salt-minion</strong> service runs on the kubernetes-master and each kubernetes-node in the cluster.</p>

<p>Each salt-minion service is configured to interact with the <strong>salt-master</strong> service hosted on the kubernetes-master via the <strong>master.conf</strong> file <a href="#standalone-salt-configuration-on-gce-and-others">(except on GCE and OpenStack-Heat)</a>.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#666">[</span>root@kubernetes-master<span style="color:#666">]</span> $ cat /etc/salt/minion.d/master.conf
master: kubernetes-master</code></pre></div>
<p>The salt-master is contacted by each salt-minion and depending upon the machine information presented, the salt-master will provision the machine as either a kubernetes-master or kubernetes-node with all the required capabilities needed to run Kubernetes.</p>

<p>If you are running the Vagrant based environment, the <strong>salt-api</strong> service is running on the kubernetes-master.  It is configured to enable the vagrant user to introspect the salt cluster in order to find out about machines in the Vagrant environment via a REST API.</p>

<h2 id="standalone-salt-configuration-on-gce-and-others">Standalone Salt Configuration on GCE and others</h2>

<p>On GCE and OpenStack, using the Openstack-Heat provider, the master and nodes are all configured as <a href="http://docs.saltstack.com/en/latest/topics/tutorials/standalone_minion.html" target="_blank">standalone minions</a>. The configuration for each VM is derived from the VM&rsquo;s <a href="https://cloud.google.com/compute/docs/metadata" target="_blank">instance metadata</a> and then stored in Salt grains (<code>/etc/salt/minion.d/grains.conf</code>) and pillars (<code>/srv/salt-overlay/pillar/cluster-params.sls</code>) that local Salt uses to enforce state.</p>

<p>All remaining sections that refer to master/minion setups should be ignored for GCE and OpenStack. One fallout of this setup is that the Salt mine doesn&rsquo;t exist - there is no sharing of configuration amongst nodes.</p>

<h2 id="salt-security">Salt security</h2>

<p><em>(Not applicable on default GCE and OpenStack-Heat setup.)</em></p>

<p>Security is not enabled on the salt-master, and the salt-master is configured to auto-accept incoming requests from minions.  It is not recommended to use this security configuration in production environments without deeper study.  (In some environments this isn&rsquo;t as bad as it might sound if the salt master port isn&rsquo;t externally accessible and you trust everyone on your network.)</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#666">[</span>root@kubernetes-master<span style="color:#666">]</span> $ cat /etc/salt/master.d/auto-accept.conf
open_mode: True
auto_accept: True</code></pre></div>
<h2 id="salt-minion-configuration">Salt minion configuration</h2>

<p>Each minion in the salt cluster has an associated configuration that instructs the salt-master how to provision the required resources on the machine.</p>

<p>An example file is presented below using the Vagrant based environment.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#666">[</span>root@kubernetes-master<span style="color:#666">]</span> $ cat /etc/salt/minion.d/grains.conf
grains:
  etcd_servers: <span style="color:#b8860b">$MASTER_IP</span>
  cloud: vagrant
  roles:
    - kubernetes-master</code></pre></div>
<p>Each hosting environment has a slightly different grains.conf file that is used to build conditional logic where required in the Salt files.</p>

<p>The following enumerates the set of defined key/value pairs that are supported today.  If you add new ones, please make sure to update this list.</p>

<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>api_servers</code></td>
<td>(Optional) The IP address / host name where a kubelet can get read-only access to kube-apiserver</td>
</tr>

<tr>
<td><code>cbr-cidr</code></td>
<td>(Optional) The minion IP address range used for the docker container bridge.</td>
</tr>

<tr>
<td><code>cloud</code></td>
<td>(Optional) Which IaaS platform is used to host Kubernetes, <em>gce</em>, <em>azure</em>, <em>aws</em>, <em>vagrant</em></td>
</tr>

<tr>
<td><code>etcd_servers</code></td>
<td>(Optional) Comma-delimited list of IP addresses the kube-apiserver and kubelet use to reach etcd.  Uses the IP of the first machine in the kubernetes_master role, or 127.0.0.1 on GCE.</td>
</tr>

<tr>
<td><code>hostnamef</code></td>
<td>(Optional) The full host name of the machine, i.e. uname -n</td>
</tr>

<tr>
<td><code>node_ip</code></td>
<td>(Optional) The IP address to use to address this node</td>
</tr>

<tr>
<td><code>hostname_override</code></td>
<td>(Optional) Mapped to the kubelet hostname-override</td>
</tr>

<tr>
<td><code>network_mode</code></td>
<td>(Optional) Networking model to use among nodes: <em>openvswitch</em></td>
</tr>

<tr>
<td><code>networkInterfaceName</code></td>
<td>(Optional) Networking interface to use to bind addresses, default value <em>eth0</em></td>
</tr>

<tr>
<td><code>publicAddressOverride</code></td>
<td>(Optional) The IP address the kube-apiserver should use to bind against for external read-only access</td>
</tr>

<tr>
<td><code>roles</code></td>
<td>(Required) 1. <code>kubernetes-master</code> means this machine is the master in the Kubernetes cluster.  2. <code>kubernetes-pool</code> means this machine is a kubernetes-node.  Depending on the role, the Salt scripts will provision different resources on the machine.</td>
</tr>
</tbody>
</table>

<p>These keys may be leveraged by the Salt sls files to branch behavior.</p>

<p>In addition, a cluster may be running a Debian based operating system or Red Hat based operating system (Centos, Fedora, RHEL, etc.).  As a result, it&rsquo;s important to sometimes distinguish behavior based on operating system using if branches like the following.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-liquid" data-lang="liquid">{% if grains[&#39;os_family&#39;] == &#39;RedHat&#39; %}
// something specific to a RedHat environment (Centos, Fedora, RHEL) where you may use yum, systemd, etc.
{% else %}
// something specific to Debian environment (apt-get, initd)
{% endif %}</code></pre></div>
<h2 id="best-practices">Best Practices</h2>

<p>When configuring default arguments for processes, it&rsquo;s best to avoid the use of EnvironmentFiles (Systemd in Red Hat environments) or init.d files (Debian distributions) to hold default values that should be common across operating system environments.  This helps keep our Salt template files easy to understand for editors who may not be familiar with the particulars of each distribution.</p>

<h2 id="future-enhancements-networking">Future enhancements (Networking)</h2>

<p>Per pod IP configuration is provider-specific, so when making networking changes, it&rsquo;s important to sandbox these as all providers may not use the same mechanisms (iptables, openvswitch, etc.)</p>

<p>We should define a grains.conf key that captures more specifically what network configuration environment is being used to avoid future confusion across providers.</p>



				<div class="issue-button-container">
					<p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/setup/salt.md?pixel" alt="Analytics" /></a></p>
					
					
					<script type="text/javascript">
					PDRTJS_settings_8345992 = {
					"id" : "8345992",
					"unique_id" : "\/docs\/setup\/salt\/",
					"title" : "Configuring Kubernetes with Salt",
					"permalink" : "https:\/\/kubernetes.io\/docs\/setup\/salt\/"
					};
					(function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
					</script>
					<a href="" onclick="window.open('https://github.com/kubernetes/website/issues/new?title=Issue%20with%20' +
					'k8s.io'+window.location.pathname)" class="button issue">Create an Issue</a>
					
					
					
					<a href="/docs/editdocs#docs/setup/salt.md" class="button issue">Edit this Page</a>
					
				</div>
			</div>
		</section>
		<footer>
    <main class="light-text">
        <nav>
            
            
            
            <a href="/docs/home/">Documentation</a>
            
            <a href="/blog/">Blog</a>
            
            <a href="/partners/">Partners</a>
            
            <a href="/community/">Community</a>
            
            <a href="/case-studies/">Case Studies</a>
            
        </nav>
        <div class="social">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://discuss.kubernetes.io" class="mailing-list"><span>Forum</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
            <div>
                <a href="/docs/setup/pick-right-solution/" class="button">Get Kubernetes</a>
                <a href="https://git.k8s.io/community/contributors/guide" class="button">Contribute</a>
            </div>
        </div>
        <div id="miceType" class="center">
            &copy; 2018 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a>
        </div>
        <div id="miceType" class="center">
            Copyright &copy; 2018 The Linux Foundation&reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">Trademark Usage page</a>
        </div>
    </main>
</footer>

		<button class="flyout-button" onclick="kub.toggleToc()"></button>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-36037335-10', 'auto');
ga('send', 'pageview');


(function () {
    window.addEventListener('DOMContentLoaded', init)

        
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
        if (!toc) return
            var container = toc.querySelector('.container')

                
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>



	</body>
</html>